# 日志
 - [ ] 画一张 Room 状态机图
 - [ ] 写一个 一局游戏的时间线（文字）
 - [ ] 设计一条「线索生成规则」
 - [ ] 设置如无其他人同时在线，默认玩家操作


# 🎭 项目代号（暂定）

**Closed Room**
*A Web-based Multiplayer Deduction Game Inspired by Classic Detective Fiction*



## 一、MVP 的「克制原则」（先立规矩）

**MVP 只做：**

* 单房间
* 4–6 人
* 1 种凶手
* 1 种侦探
* 可跑完整一局


## 二、核心玩法（一句话版）

> 玩家被困在一间封闭场所
> 一名玩家是凶手
> 每个夜晚发生一件“事件”
> 玩家通过有限线索与讨论
> 在投票阶段指认凶手


## 三、游戏阶段状态机（后端核心）

```text
LOBBY
  ↓ (玩家满员)
NIGHT
  ↓ (夜晚行动结算)
DISCUSSION
  ↓ (倒计时结束)
VOTING
  ↓
RESULT
  ↺ (若未结束，进入 NIGHT)
```

### 每个状态的**权限规则**（重点）

| 状态         | 玩家能做什么    |
| ---------- | --------- |
| LOBBY      | 加入 / 准备   |
| NIGHT      | 仅发送「夜晚指令」 |
| DISCUSSION | 聊天        |
| VOTING     | 投票        |
| RESULT     | 只读        |

👉 **客户端可以点，服务器决定“允不允许”**


## 四、最小角色系统（只有 3 种）

### 🎩 Detective（1 人）

* 夜晚可查看 **一条线索**
* 不直接知道凶手

### 🔪 Murderer（1 人）

* 夜晚选择 **一名玩家进行谋杀**
* 行动结果次日生效

### 🧍 Guest（其余）

* 无技能
* 参与讨论和投票

> 人数建议：4–6
> 角色比例固定（MVP 不随机）


## 五、线索系统（阿加莎感的灵魂）

这是你项目的 **“文学 → 系统” 转换点**。

### 夜晚，服务器生成一条线索：

```js
Clue {
  type: "LOCATION" | "TIME" | "ITEM",
  content: "凶手曾出现在书房附近",
  reliability: 0.8
}
```

规则：

* 只发给 Detective
* 不保证 100% 正确
* 永远不直接点名

👉 这是**系统设计能力的体现**，不是剧情。


## 六、数据结构（你后端最该想清楚的）

### Room（全局状态）

```js
Room {
  phase: "NIGHT",
  round: 1,
  players: Map<id, Player>,
  votes: {},
  logs: []
}
```

### Player（每人一份）

```js
Player {
  id,
  role,
  alive: true,
  vote: null,
  knowledge: [] // 仅 server 知道完整内容
}
```

⚠️ **身份 & 线索永远不发给无权限玩家**

## 七、服务器的职责（这是你 MVP 的技术内核）

服务器是：

> ❌ 不是转发器
> ❌ 不是同步工具
> ✅ 是「裁判 + 规则引擎」

必须做到：

* 推进阶段（setTimeout / tick）
* 校验操作合法性
* 结算夜晚事件
* 广播 **“该广播的状态子集”**


## 八、前端 MVP（只要“清楚”，不求“漂亮”）

### 一个页面，四个区块：

```
[ 当前阶段 + 倒计时 ]

[ 中央信息区 ]
- 夜晚：提示等待
- 讨论：聊天
- 投票：按钮列表

[ 右侧玩家列表 ]
- 存活 / 死亡
- 不显示身份

[ 底部操作区 ]
- 根据 phase 显示按钮
```

Canvas / DOM 都行，不要纠结。


## 九、胜利条件（简单但完整）

* 凶手死亡 → 平民胜
* 凶手人数 ≥ 存活玩家的一半 → 凶手胜
